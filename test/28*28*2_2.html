<html>
  <head>
    <meta charset="utf-8">
    <title>WebML Polyfill | Mocha Tests</title>
  </head>
  <body>
    <div id="mocha"></div>
    <div> <input type="button" onclick="predict()" value="button"></div>
    <div> <input type="file"  id="inputData"></div>
    <div><textarea id="textarea" rows=100 cols=100></textarea>></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!--script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/4.0.1/mocha.min.js"></script-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/5.2.0/mocha.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.1.2/chai.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"></script>
    <script src="../dist/webml-polyfill.js"></script>
    <script src="./utils.js"></script>
    <script>
      window.onload = setOptions;
    </script>
    <script>
      mocha.setup('bdd');
    </script>
    <!--script src="./cts/test/V1_0/avg_pool_float_2.js"></script-->
    <!--script src="./cts/test/V1_0/resize_bilinear.js"></script-->
    <!--script src="./cts/test/V1_0/conv_float.js"></script-->
    <!--script src="./cts/test/V1_0/add.js"></script-->
    <!-- <script src="./cts/test/V1_0_plus/depthwise_conv_relu.js"></script> -->
    <!--script src="./cts/test/V1_0/depthwise_conv2d_float_large_2.js"></script-->
    <script>

      // window.mochaFinish = false;
      // mocha.globals(['jQuery']);
      // mocha.run(function() {window.mochaFinish = true});

var input_data, weights_data, bais_data, output_data, op3_output;
      function predict() {

describe('CTS', function() {
        const assert = chai.assert;
  const nn = navigator.ml.getNeuralNetworkContext();

  it('check result for Depthwise conv relu example-1', async function() {
    let model = await nn.createModel(options);
    let operandIndex = 0;

    // let input_length = 28 * 28 * 1;
    // var new_input_data = new Float32Array(input_length);
    // for (var i = 0; i < input_length; i++) {
    //     new_input_data[i] = input_data[i];
    // }
    input_data = new Float32Array([ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28,
                                    1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25, 26,27, 28]);;
    console.log(input_data.length);


    // let weight_length = 5 * 5 * 1;
    // var new_weight_length = new Float32Array(weight_length);
    // for (var i = 0; i < weight_length; i++) {
    //     new_weight_length[i] = weights_data[i];
    // }
    weights_data = new Float32Array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25,
                                     1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24,25]);
    // weights_data = new Float32Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
    console.log(weights_data.length);

    bais_data = new Float32Array([1, 2]);

    let op2_value = input_data;
    let op3_expect = output_data;
    op3_expect = new Float32Array([374,494,689,832,1096,1262,1546,1692,1996,2122,2446,2552,2896,2982,3346,3412,3796,3842,4246,4272,4696,4702,5146,5132,4420,4302,3862,3640,2772,3146,1850,2120,1096,1262,1546,1692,1996,2122,2446,2552,2896,2982,3346,3412,3796,3842,4246,4272,4696,4702,5146,5132,4378,4212,3700,3382,535,718,965,1192,1511,1782,2111,2372,2711,2962,3311,3552,3911,4142,4511,4732,5111,5322,5711,5912,6311,6502,6911,7092,5803,5862,4919,4856,3559,4074,2423,2816,1511,1782,2111,2372,2711,2962,3311,3552,3911,4142,4511,4732,5111,5322,5711,5912,6311,6502,6911,7092,5742,5732,4683,4482,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,606,822,1081,1352,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6216,6402,5186,5232,3736,4342,2566,3032,1676,2002,2326,2652,2976,3302,3626,3952,4276,4602,4926,5252,5576,5902,6226,6552,6876,7202,7526,7852,6146,6252,4916,4802,400,538,725,892,1136,1332,1586,1772,2036,2212,2486,2652,2936,3092,3386,3532,3836,3972,4286,4412,4736,4852,5186,5292,4348,4332,3734,3596,2644,3084,1778,2096,1136,1332,1586,1772,2036,2212,2486,2652,2936,3092,3386,3532,3836,3972,4286,4412,4736,4852,5186,5292,4302,4232,3558,3312,284,374,529,632,846,962,1196,1292,1546,1622,1896,1952,2246,2282,2596,2612,2946,2942,3296,3272,3646,3602,3996,3932,3450,3282,3072,2800,2162,2486,1420,1640,846,962,1196,1292,1546,1622,1896,1952,2246,2282,2596,2612,2946,2942,3296,3272,3646,3602,3996,3932,3418,3212,2950,2602]);

    let type0 = {type: nn.INT32};
    let type2 = {type: nn.TENSOR_FLOAT32, dimensions: [1, 5, 5, 2]};
    let type2_length = product(type2.dimensions);
    let type1 = {type: nn.TENSOR_FLOAT32, dimensions: [1, 28, 28, 2]};
    let type1_length = product(type1.dimensions);
    let type3 = {type: nn.TENSOR_FLOAT32, dimensions: [2]};
    let type3_length = product(type3.dimensions);
    let type4 = {type: nn.TENSOR_FLOAT32, dimensions: [1, 28, 28, 2]};
    let type4_length = product(type4.dimensions);

    let b4 = operandIndex++;
    model.addOperand(type0);
    let b5 = operandIndex++;
    model.addOperand(type0);
    let b6 = operandIndex++;
    model.addOperand(type0);
    let b7 = operandIndex++;
    model.addOperand(type0);
    let b8 = operandIndex++;
    model.addOperand(type0);
    let op2 = operandIndex++;
    model.addOperand(type1);
    let op3 = operandIndex++;
    model.addOperand(type4);
    let op0 = operandIndex++;
    model.addOperand(type2);
    let op1 = operandIndex++;
    model.addOperand(type3);

    model.setOperandValue(b4, new Int32Array([1]));
    model.setOperandValue(b5, new Int32Array([1]));
    model.setOperandValue(b6, new Int32Array([1]));
    model.setOperandValue(b7, new Int32Array([1]));
    model.setOperandValue(b8, new Int32Array([0]));
    // var new_weights_data = new Float32Array(bais_data);
    // var filter_height = 5, filter_width = 5, depth_out = 528;
    // for (var h = 0; h < filter_height; h++) {
    //   for (var w = 0; w < filter_width; w++) {
    //     for (var c = 0; c < depth_out; c++) {
    //       new_weights_data[c * filter_height * filter_width +
    //                         h * filter_width + w] =
    //           weights_data[h * filter_width * depth_out + w * depth_out + c];
    //     }
    //   }
    // }
    model.setOperandValue(op0, new Float32Array(weights_data));
    model.setOperandValue(op1, new Float32Array(bais_data));
    model.addOperation(nn.DEPTHWISE_CONV_2D, [op2, op0, op1, b4, b5, b6, b7, b8], [op3]);

    model.identifyInputsAndOutputs([op2], [op3]);
    await model.finish();

    let compilation = await model.createCompilation();
    compilation.setPreference(prefer);
    await compilation.finish();

    let execution = await compilation.createExecution();

    let op2_input = new Float32Array(op2_value);
    execution.setInput(0, op2_input);

    op3_output = new Float32Array(type4_length);
    execution.setOutput(0, op3_output);

    await execution.startCompute();

    for (let i = 0; i < type4_length; ++i) {
      if(!almostEqualCTS(op3_output[i], op3_expect[i])) {
        console.log("index: " + i + " op3_output " + op3_output[i] + " op3_expect " + op3_expect[i]);
        break;
      }
    }
    
    let sum = 0;
      for (let i = 0; i < type4_length; i++) {
        sum += Math.pow(op3_output[i] - op3_expect[i], 2);
      }
      console.log(`var: ${sum / type4_length}`);
});
});



window.mochaFinish = false;
      mocha.globals(['jQuery']);
      mocha.run(function() {window.mochaFinish = true});
}


var i = 0;
// <textarea id="textarea" rows=100 cols=100>
// var textarea = document.getElementById("textarea")
// textarea.value=
inputData.addEventListener('change', function(e) {
            var file = inputData.files[0];
            var textType = /text.*/;

            if (file.type.match(textType)) {
                var reader = new FileReader();

                reader.onload = function(e) {
                    var text = reader.result;
                    var arr = text.split(",");
                    var file_data = new Float32Array(arr.length);
                    for(j in arr) {
                       var b = parseFloat(arr[j]);
                       file_data[j] = b;
                    }
                  
                   // new_float_array = new Float32Array(origin_float_array);
                   // var width = 513, height = 513, depth = 21;
                   // for (var c = 0; c < depth; c++) {
                   //   for (var h = 0; h < height; h++) {
                   //     for (var w = 0; w < width; w++) {
                   //       new_float_array[c +
                   //                         h * width * depth + w * depth] =
                   //       origin_float_array[c * width * height + h * width + w];
                   //     }
                   //   }
                   // }

                   if (i == 0) {
                      input_data = file_data;
                    } else if (i == 1) {
                        weights_data = file_data;
                    } else if (i == 2) {
                        bais_data = file_data;
                    } else if (i == 3) {
                        output_data = file_data;
                    }
                    i++;
                   console.log(file_data.length);
                }

                reader.readAsText(file);    
            } else {
                fileDisplayArea.innerText = "File not supported!"
            }
        });
    </script>
  </body>
</html>
